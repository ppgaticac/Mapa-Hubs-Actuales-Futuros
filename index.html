<!DOCTYPE html>
<html>
<head>
    <title>Integración Dinámica de Google Maps</title>
    <style>
        #map {
            height: 80%;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #search-box {
            width: 300px;
            margin-top: 10px;
        }
        #distance-list {
            margin-top: 10px;
        }
        .distance-item {
            padding: 5px;
        }
        .green-bg {
            background-color: #d4edda;
        }
        .red-bg {
            background-color: #f8d7da;
        }
        #result-list {
            max-height: 200px;
            overflow-y: auto;
            background-color: white;
            border: 1px solid #ccc;
            padding: 10px;
        }
        .result-item {
            cursor: pointer;
            margin-bottom: 5px;
        }
        .result-item:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <input id="search-box" type="text" placeholder="Buscar...">
    <button id="reset-button">Reiniciar</button>
    <div id="result-list"></div>
    <div id="distance-list"></div>
    <div id="map"></div>

    <script>
        let mapa;
        let renderizadorDirecciones = new google.maps.DirectionsRenderer();
        let ventanaInfo = new google.maps.InfoWindow();
        let marcadores = [];

        function initMap() {
            mapa = new google.maps.Map(document.getElementById('map'), {
                center: { lat: -33.4489, lng: -70.6693 },
                zoom: 12
            });

            renderizadorDirecciones.setMap(mapa);

            hubs.forEach(hub => {
                let marcador = new google.maps.Marker({
                    position: { lat: hub.lat, lng: hub.lng },
                    map: mapa,
                    title: hub.nombre,
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 10,
                        fillColor: hub.tipo === 'activo' ? 'green' : 'red',
                        fillOpacity: 1,
                        strokeWeight: 1,
                        strokeColor: 'black'
                    }
                });

                google.maps.event.addListener(marcador, 'click', function () {
                    ventanaInfo.setContent('<div><strong>' + hub.nombre + '</strong><br>' + hub.direccion + '</div>');
                    ventanaInfo.open(mapa, this);
                });

                marcadores.push(marcador);
            });

            document.getElementById('search-box').addEventListener('input', function () {
                buscarHubs(this.value);
            });

            document.getElementById('reset-button').addEventListener('click', function () {
                resetMap();
            });
        }

        function buscarHubs(termino) {
            const resultados = hubs.filter(hub => hub.nombre.toLowerCase().includes(termino.toLowerCase()));
            mostrarResultados(resultados);
        }

        function mostrarResultados(resultados) {
            const listaResultados = document.getElementById('result-list');
            listaResultados.innerHTML = '';

            resultados.forEach(resultado => {
                const item = document.createElement('div');
                item.className = 'result-item';
                item.textContent = resultado.nombre;
                item.addEventListener('click', function () {
                    centrarMapa(resultado);
                });
                listaResultados.appendChild(item);
            });
        }

        function centrarMapa(hub) {
            mapa.setCenter({ lat: hub.lat, lng: hub.lng });
            mapa.setZoom(15);
        }

        function resetMap() {
            mapa.setCenter({ lat: -33.4489, lng: -70.6693 });
            mapa.setZoom(12);
            document.getElementById('search-box').value = '';
            document.getElementById('result-list').innerHTML = '';
        }

        const hubs = [
            { lat: -33.509915, lng: -70.650638, nombre: "Ciudad del niño", direccion: "Gran Av. José Miguel Carrera 6150, 8930520 San Miguel, Región Metropolitana", tipo: "futuro" },
            { lat: -33.524596, lng: -70.598747, nombre: "Florida center", direccion: "Av. Vicuña Mackenna Ote. 6100, 8242155 La Florida, Región Metropolitana", tipo: "futuro" },
            { lat: -33.501710, lng: -70.662125, nombre: "Portal el Llano", direccion: "Llano Subercaseaux, 8910339 San Miguel, Región Metropolitana", tipo: "futuro" },
            { lat: -33.444121, lng: -70.649597, nombre: "Alto San Francisco", direccion: "San Francisco 75, Santiago, Región Metropolitana", tipo: "futuro" },
            { lat: -33.457415, lng: -70.649070, nombre: "Nathaniel Cox", direccion: "Nataniel Cox 620, 8331081 Santiago, Región Metropolitana", tipo: "futuro" },
            { lat: -33.456594, lng: -70.648503, nombre: "Otra dirección", direccion: "Alguna dirección más", tipo: "futuro" }
        ];
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAovSlHVEYWgZf3a_Skux_nwRCcPZUM6rI&callback=initMap&libraries=places,geometry"></script>
</body>
</html>
